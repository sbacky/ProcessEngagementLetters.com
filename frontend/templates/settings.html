<!--
Copyright (C) 2023 - Neil Crum (nhc.crum@outlook.com)

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
-->
{% extends 'base.html' %}

{% block title %}Settings{% endblock %}

{% block headScript %}
<script type="module">
    import app from './scripts/app.js';
    await app.setup('userSettings');
    window.app = app;

    const userSettingsForm = document.getElementById('userSettings');
    userSettingsForm.addEventListener('submit', (event) => {
        event.preventDefault();

        const csrf = userSettingsForm.getElementById('csrf-token').value;
        const formElements = userSettingsForm.querySelectorAll('.formElement');
        
        app.saveUserSettings(formElements, csrf);
    });
</script>
{% endblock %}

{% block content %}
<form method="post" action="/settings" enctype="multipart/form-data" id="userSettings">
    <input type="hidden" name="csrf-token" id="csrf-token" value="{{ csrf_token() }}">
    <div id="userSettings-alertPlaceholder"></div>
    {% for setting in settings %}
        <div class="formElement">
            <label for="{{ setting.id }}">{{ setting.name }}</label>
            {% if setting.type == 'string' %}
                <input type="text" id="{{ setting.id }}" name="{{ setting.config_name }}" value="{{ setting.value }}">
            {% elif setting.type == 'number' %}
                <input type="text" id="{{ setting.id }}" name="{{ setting.config_name }}" value="{{ setting.value }}">
            {% endif %}
            <small>{{ setting.description }}</small>
        </div>
    {% endfor %}
    <button type="submit">Save Settings</button>
</form>
<div id="alertModal-overlay" class="modal-overlay"></div>
{% endblock %}